<!DOCTYPE html>
<html>
<head>
	<title>Edit M3U File</title>
	<style>
		.styled-input {
			border: 1px solid #000;
			padding: 6px;
		}
	</style>
</head>
<body>
	<h1>Edit M3U File: {{.filename}}</h1>
	<table id="entriesTable">
		<thead>
			<tr>
				<th>Id</th>
				<th>Station Id</th>
				<th>Channel Name</th>
				<th>Stream Location</th>
                <th>Group</th> <!-- New Header -->
                <th>Logo</th> <!-- New Header -->
				<th>Action</th>
			</tr>
		</thead>
		<tbody>
			{{range .entries}}
			<tr>
			    <td class="styled-input" contentEditable="true">{{ .Id }}</td>
			    <td class="styled-input" contentEditable="true">{{ .StationId }}</td>
			    <td class="styled-input" contentEditable="true">{{ .ChannelName }}</td>
			    <td class="styled-input" contentEditable="true">{{ .StreamURL }}</td> 
                <td class="styled-input" contentEditable="true">{{ .Group }}</td> <!-- New Data Field -->
                <td class="styled-input" contentEditable="true">{{ .Logo }}</td> <!-- New Data Field -->
			    <td><button onclick="deleteRow(this)">Delete</button></td>
			</tr>
			{{end}}
		</tbody>
	</table>
	<p>Total Channels: {{ len .entries }}</p>
	<button onclick="addRow()">Add Channel</button>
	<p/>
	<button onclick="saveData()">Save</button> 	<button onclick="cancel()">Cancel</button> 
	<script>
		function deleteRow(btn) {
			var row = btn.parentNode.parentNode;
			row.parentNode.removeChild(row);
		}
        function addRow() {
            var table = document.getElementById("entriesTable");
            var row = table.insertRow(-1);
            for(let i=0; i<7; i++) {
                var cell = row.insertCell(i);
                cell.className = "styled-input";
                if(i < 6) cell.contentEditable = "true"; // Make it contentEditable except the last one for the button
                if(i == 6) cell.innerHTML = '<button onclick="deleteRow(this)">Delete</button>';
            }
        }
		function saveData() {
            let table = document.getElementById('entriesTable');
            let entries = [];
            for (let i = 1, row; row = table.rows[i]; i++) {
                let entry = {
                    Id: row.cells[0].innerText,
                    StationId: row.cells[1].innerText,
                    ChannelName: row.cells[2].innerText,
                    StreamURL: row.cells[3].innerText,
                    Group: row.cells[4].innerText, 
                    Logo: row.cells[5].innerText  
                };
                entries.push(entry);
            }
		    fetch('/m3usave/{{ .filename }}', {
		        method: 'POST',
		        headers: {
		            'Content-Type': 'application/json',
		        },
		        body: JSON.stringify(entries),
		    })
		    .then(response => response.json())
		    .then(data => alert(data.status))
		    .catch((error) => {
		        console.error('Error:', error);
		    });
		}
		function cancel() {
			window.location.href = "/";
		}
	</script>
</body>
</html>
